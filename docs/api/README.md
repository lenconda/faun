# API

## Methods & Props

### `Faun.prototype.registerSubApplications(config)`

Register sub-applications configuration.

- Parameters
  - `config`: `ISubApplicationConfigMap`. Required, a key-value map structure stores sub-applications configuration
- Types
  - `ISubApplicationConfigMap`
    - [Type definition](#doc-isubapplicationconfigmap)
    - `key`: `string`. Required, the active route for one sub-application, each key is unique in one map. e.g. `/foo`
    - `ISubApplicationConfig`. Required, the configuration for current sub-application
  - `ISubApplicationConfig`
    - [Type definition](#doc-isubapplicationconfig)
    - `mountPointID`: `string`. Required, the mount point ID for current sub-application. e.g. if pass `app` to `mountPointID`, Faun will create a `HTMLDivElement` element with ID of `app`
    - `scripts`: `Array<string>`. Optional, default `null`. JavaScript resource URLs for current sub-application
    - `styles`: `Array<string>`. Optional, default `null`. CSS resource URLS for current sub-application
    - `useCSSPrefix`: `boolean`. Optional, default `true`. By default, Faun will add a random string to `document.documentElement.classList`, such as `<html class="qz7Ux3v0">...</html>`
    - `assetURLMapper`: `(url: string) => string`. Optional, default `url => url`. When the [`publicPath`](https://webpack.js.org/guides/public-path/) of the sub-application is not the absolute path, such as `/` or `./`, `assetURLMapper` will help to add the proper prefix. e.g. `url => '//example.com/foo' + url` can add `//example.com/foo` to all of the chunked assets: `/0.chunk.js` -> `//example.com/foo/0.chunk.js`
    - `prefixElementSelector`: `() => Node`. Optional, default `() => document.documentElement`. Related to `useCSSPrefix`, it will help to change the default element while default behavior is prefixing a CSS class to `document.documentElement`

### `Faun.prototype.run()`

Starts the Faun instance. When all of the configurations are finished, it should be invoked.

### `Faun.prototype.history` & `Faun.history`

`history` is an instance of [ReactTraining/history](https://github.com/ReactTraining/history) generated by `createBrowserHistory`, check out the documentation [here](https://github.com/ReactTraining/history/blob/master/docs/api-reference.md).

### `Faun.prototype.addGlobalDependence(name, dep)`

- Parameters
  - `name`: `string`. Required, the name for current dependence. The dependence will be added to `window` as a global variable: `window[name] = dep`
  - `dep`: `any`. Required, could be any thing. It could be accessed by `window[name]`

### `Faun.use(plugin, options?)`

Add a plugin to `Faun.prototype`.

- Parameters
  - `plugin`: `IPlugin`. Required, pass an plugin with type of `IPlugin`, the plugin should be injected into `Faun.prototype`
  - `options`: `Record<string, any>`. Optional, pass the options for current plugin
- Types
  - `IPlugin`
    - [Type definition](#doc-iplugin)
    - `install`: `(Faun: Faun) => any`. Required, `install` method should be implemented in all plugins, cause the plugin system will call `install` method when installing plugins

### `Faun.prototype.events`

- Types
  - [Type definition](#doc-ievent)

#### `emit(key, data?)`

Fire a specified event, and call all of its handlers.

- `key`: `string`. Required, name of event that want to be fired
- `data`: `any`. Optional, data passed to the event handler

#### `on(key, callback)` :id=doc-events-on

Add an event handler to a specified event.

- `key`: `string`. Required, name of event
- `callback`: `(data?) => any`. Required, event handler

#### `off(key, callback)`

Remove specified callback of specified event

- `key`: `string`. Required, name of event
- `callback`: `(data?) => any`. Required, traverse all the handlers of specified event, in the meantime remove the specified callback

#### `has(key, callback)`

- `key`: `string`. Required, name of event
- `callback`: `(data?) => any`. Required, traverse all the handlers of specified event, in the meantime find the specified callback and return it

### `Faun.prototype.store`

- Types
  - [Type definition](#doc-istore)

#### `set(key, value)`

Set a record to store.

- `key`: `string`. Required, name of a store record
- `value`: `any`. Required, value of a store record

#### `get(key)`

Get a record to store.

- `key`: `string`. Required, name of a store record

## Lifecycle Hooks

- Types
  [Type definition](#doc-ihooks)

### `loading(pathname)`

Be executed when loading a new sub-application.

- Parameters
  - `pathname`: `string`. Current top-level pathname

### `loaded(pathname)`

Be executed when a new sub-application is successfully loaded.

- Parameters
  - `pathname`: `string`. Current top-level pathname

### `mounted(pathname, sandbox)`

Be executed when a new sub-application is successfully mounted.

- Parameters
  - `pathname`: `string`. Current top-level pathname
  - `sandbox`: `Sandbox`. Sandbox that currently mounted
- Types
  - `Sandbox`
    - [Type definition](#doc-sandbox)

### `beforeUnmount(prev, next)`

Be executed when current sub-application will be unmounted.

- Parameters
  - `prev`: `string`. Current top-level pathname
  - `next`: `string`. Next top-level pathname

### `mounted(pathname, sandbox)`

Be executed when current sub-application is successfully unmounted.

- Parameters
  - `prev`: `string`. Current top-level pathname
  - `next`: `string`. Next top-level pathname
  - `sandbox`: `Sandbox`. Sandbox that currently mounted
- Types
  - `Sandbox`
    - [Type definition](#doc-sandbox)

# Type Definitions

## `ISubApplicationConfigMap` :id=doc-isubapplicationconfigmap

The declerations for sub-application configuration map.

- Entry

```javascript
import { ISubApplicationConfigMap } from 'faun';
```

- Typing

```javascript
declare interface ISubApplicationConfigMap {
  [key: string]: Partial<ISubApplicationConfig>;
}
```

## `ISubApplicationConfig` :id=doc-isubapplicationconfig

- Entry

```javascript
import { ISubApplicationConfig } from 'faun';
```

- Typing

```javascript
declare interface ISubApplicationConfig {
  scripts?: Array<string>;
  styles?: Array<string>;
  mountPointID: string;
  useCSSPrefix?: boolean;
  assetURLMapper?: (url: string) => string;
  prefixElementSelector?: () => Node;
}
```

## `IPlugin` :id=doc-iplugin

- Entry

```javascript
import { IPlugin } from 'faun';
```

- Typing

```javascript
declare interface IPlugin {
  install: Function;
  [key: string]: any;
}
```

## `IEvent` :id=doc-ievent

- Entry

```javascript
import { IEvent } from 'faun';
```

- Typing

```javascript
export interface IEvent {
  emit: (key: string, data: any) => any;
  on: (key: string, callback: () => any)  => () => any;
  off: (key: string, callback: () => any) => () => any;
  has: (key: string) => boolean;
}
```

## `IStore` :id=doc-istore

- Entry

```javascript
import { IStore } from 'faun';
```

- Typing

```javascript
export interface IStore {
  set: (key: string|object, value: any) => void;
  get: (key: string) => any;
  on: (key: string, callback: () => any) => () => any;
}
```

## `IHooks` :id=doc-ihooks

- Entry

```javascript
import { IHooks } from 'faun';
```

- Typing

```javascript
export interface IHooks {
  loading: (pathname: string) => any;
  loaded: (pathname: string) => any;
  mounted: (pathname: string, sandbox: Sandbox) => any;
  beforeUnmount: (prev: string, next: string) => boolean;
  unmounted: (prev: string, next: string, sandbox: Sandbox) => any;
}
```

## `Sandbox` :id=doc-sandbox

- Entry

```javascript
import { Sandbox } from 'faun';
```

- Typing

```javascript
export abstract class Sandbox {
  constructor(name: string, useCSSPrefix: boolean);

  mountPointID: string;
  name: string;
  bundles: Array<string>;
  css: Array<string>
  usePrefix: boolean;

  abstract assetURLMapper(url: string): string;
  abstract prefixElementSelector(): Node;

  abstract takeDOMSnapshot(): void;
  abstract restoreDOMSnapshot(): void;
  abstract takeWindowSnapshot(): void;
  abstract restoreWindowSnapshot(): void;
  abstract create(subApplicationConfig: ISubApplicationConfig): Promise<void | null>;
  abstract mount(): void;
  abstract unmount(): void;
}
```

## `Faun` :id=doc-faun

- Entry

```javascript
import { Faun } from 'faun';
```

- Typing

```javascript
declare abstract class Faun {
  constructor();

  abstract run(): void;
  abstract registerSubApplications(config: ISubApplicationConfigMap): void;
  abstract addGlobalDependence<T extends Record<string, any>>(name: string, dep: T): void;

  public history: History<LocationState>;

  public hooks: IHooks;
  public store: IStore;
  public events: IEvent;

  static use<T extends Record<string, any>>(plugin: IPlugin, options: T): void;
}
```
